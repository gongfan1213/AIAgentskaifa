### AI Agent应用与项目实战

Market and Pharmacy、Hobbs Cafe、The Rose and Crown Pub。

（如果活动可以在那里完成，最好留在当前区域）

Eddy计划在它的工作场所周围散步。Eddy应该去哪里？

这将输出"The Lin family's house"的结果。我们使用相同的过程递归地确定所选区域内最合适的子区域，直到到达生成式代理环境树的叶节点。在上述示例中，这次遍历的结果是“林氏家族的房子：花园：房子花园”(The Lin family's house: garden: house garden)。最后，使用传统的游戏路径算法并以动画的形式表现生成式代理的移动，使其到达叶节点指示的位置。

当生成式代理对一个对象执行动作时，研究团队会提示大语言模型询问该对象状态的变化。例如，如果Isabella的生成式代理输出“为顾客制作浓缩咖啡”的动作，则大语言模型的查询会指示回应，表示Hobbs Cafe的咖啡机状态应从“空闲”变为“正在煮咖啡”。


#### 5.7 评估

生成式代理无论是作为个体代理还是作为群体，都旨在基于其环境和经历产生可信的行为。在评估中，研究团队调查了生成式代理的能力和局限性。个体代理是否能够正确检索过去的经历，并生成可信的计划、反应和思想来塑造它的行为？一个社区中的代理是否能够展示信息传播、关系形成以及社区不同部分之间的协同？

本节将生成式代理的评估分为两个阶段。首先，通过更严格的控制评估，逐个评估生成式代理的反应，以了解它们是否能在狭义定义的情境中生成可信的行为；然后，在对社区代理进行的端到端分析中，评估其作为一个整体时的群体行为，以及错误和边界条件。

#### 5.7.1 评估程序

为评估斯坦福AI小镇中的生成式代理，研究团队利用了生成式代理可以响应自然语言问题的事实，通过“询问”生成式代理来探究它们记住过去的经历、基于经历计划未来行动、适当地对意外事件做出反应，以及反思它们的表现以改进未来行动的能力。为正确回答这些问题，生成式代理必须成功检索并综合信息。因变量是行为的可信度，这是之前生成式代理工作中的一个核心因变量。询问包括5个问题类别，每个类别都旨在评估5个关键领域之一：维持自我知识、检索记忆、生成计划、反应和反思。


- **维持自我知识**：询问诸如“介绍一下自己”或“大致描述一下你的典型工作日时间表”的问题，这要求生成式代理保持对其核心特征的理解。

- **检索记忆**：提出问题，提示生成式代理检索它们记忆中的特定事件或对话，以给出正确回答，如“[某某]是谁？”或“谁在竞选市长？”

- **生成计划**：询问需要生成式代理检索它们长期计划的问题，如“明天上午10:00你会做什么？”

- **反应**：作为一个可信行为的基线，需为生成式代理提供以可信方式响应的假设情况，如“你的早餐烧焦了，你会怎么做？”

- **反思**：询问需要生成式代理利用它们对其他代理和自己更深层次的理解来获得通过更高层次的推断的见解，如“如果你必须与最近遇到的一个人共度时光，那会是谁，为什么？”

生成式代理是在进行了两天完整架构的模拟后抽取的，在模拟过程中，它们积累了许多互动经历和记忆，这些将塑造它们的响应。为了收集关于响应可信度的反馈，研究团队招募了人类评估者，并要求他们观看斯坦福AI小镇中随机选择的生成式代理的生活回放。评估者可以访问生成式代理记忆流中的所有信息。研究采用了内部受试设计，其中100名评估者比较了4种不同生成式代理架构和一个人类编写条件对同一个生成式代理的采访响应。实验展示了每个问题类别中随机选择的一个问题，以及所有条件生成的生成式代理响应。评估者对条件的可信度进行了排名。

#### 5.7.2 条件

所有条件都用于独立回答每个访谈问题。我们将生成式代理架构与一些删除了生成式代理记忆流中3种记忆类型（观察、计划和反思）访问权限的版本进行比较，还与由人工众包方式撰写的行为条件进行比较。有如下3种消融架构。

- **无观察、无计划、无反思的架构**：无法访问记忆流中的观察、计划和反思。

- **无计划、无反思的架构**：可以访问记忆流中的观察，但无法访问计划和反思。 

- **无反思的架构**：可以访问记忆流中的观察和计划，但无法访问反思。



无观察、无计划、无反思的架构实际上代表了通过大语言模型创建的生成式代理的先前状态。所有架构都可以访问生成式代理在访谈时积累的所有记忆，因此这里观察到的差异可能代表了真实差异的保守估计。实际上，消融架构在两天的模拟过程中不会遵循与完整架构相同的路径。我们选择这种实验设计方式，是因为重新模拟每个架构会导致模拟分化为不同状态，使得比较变得困难。

除了消融条件，我们还添加了一个由人工众包方式撰写的行为条件来提供一个人类基准。我们不打算通过这个基准捕捉最大限度的人类专家表现；相反，我们旨在使用这个条件来识别架构是否达到了基本的行为能力水平。这确保了我们不仅仅是在比较不同的消融版本，而是有行为基础的比较。我们为25个生成式代理分别招聘了一名独立的人类评估者，并要求他们观看该生成式代理的沙盒生活回放并检查其记忆流。然后，我们要求评估者们扮演并以他们观看的生成式代理的语气撰写对访谈问题的答案。为了确保由人工众包方式撰写的答案至少符合基准质量期望，我们手动检查了对“描述你的典型工作日的总体安排”访谈的答案，以确认这些答案是否为连贯的句子，并且符合生成式代理的语气。如果4组众包评估者撰写的答案均未达到这些标准，则再由其他众包评估者重新生成答案。



#### 5.7.3 分析

实验产生了100组排序数据，每名评估者根据可信度对5个条件进行了排序。为了将这些排序数据转换为可解释比较的区间数据，我们使用排序来计算每个条件的TrueSkill评分。TrueSkill是Elo国际象棋评分系统在多玩家环境中的推广应用，曾被Xbox Live用于基于竞技游戏表现的玩家排名。给定一组排序结果，TrueSkill输出每个条件的均值评分μ和标准差σ。具有相同评分的条件大致应当不分伯仲，每个条件在两者之间的比较中胜出一半。更高的分数表示在排名中战胜低排名条件的情况更多。

另外，为了调查这些结果的统计显著性，我们首先对原始排序数据应用了Kruskal-Wallis检验，这是一种单因素方差分析（ANOVA）的非参数替代方法。然后，我们进行了Dunn事后检验，以确定条件之间的任何成对差异。最后，我们使用Holm-Bonferroni方法对Dunn检验中的多重比较p值进行了调整，如图5-17所示。 

![image](https://github.com/user-attachments/assets/7252e710-c828-4b84-86a8-a0021e752d9b)


此外，研究团队进行了归纳性分析，研究了每种条件下产生的响应之间的定性差异。研究团队采用两个阶段的定性开放编码。在第一阶段，研究团队生成了紧密代表句子级别生成响应的代码。在第二阶段，研究团队将第一阶段产生的代码综合起来，提取出更高级别的主题。研究团队利用这些主题来比较研究中产生的响应类型。

#### 5.7.4 结果

研究结果表明，生成式代理的完整架构在所有条件中产生了最可信的行为。下面我们将完整架构的响应与其他条件的响应进行对比。然而，我们也可以看到完整架构并非没有缺陷，并指出了其失败模式。

1. **完整架构优于其他条件**

如图5-17所示，完整的生成式代理架构产生了最可信的行为（μ=29.89;σ=0.72）。在消融条件下移除每个组件后，性能逐渐下降，无反思的消融架构表现其次（μ=26.88;σ= 0.69），随后是无计划、无反思的消融架构（μ= 25.64; σ= 0.68），随后是众包评估者（μ= 22.95;σ= 0.69）。无观察、无计划、无反思的消融架构在所有条件中表现最差（μ= 21.21; σ= 0.70）。TrueSkill将每个条件的技能值建模为N(μ,σ^2)，使我们能够通过Cohen's d了解效果大小。将代表先前工作的条件（无观察、无计划、无反思）与完整架构进行比较，产生的标准化效果大小为d = 8.16，即8个标准差。

Kruskal-Wallis测试确认了各条件之间排名差异的总体统计显著性（χ²(4) = 150.29, p < 0.001）。Dunn事后测试确认，除人类众包工作者条件和完全消融基线外，所有条件之间的成对差异均显著（p < 0.001），这两个条件是表现较差的。

2. **生成式代理有记忆，并带有修饰成分**

生成式代理记住了过去的经历，但有时会加以润色。配备完整记忆模块的生成式代理能够回忆过去的经历，并在广泛的背景下以与其自我认知一致的方式回答问题。例如，当被问到“介绍一下你自己”时，动画师Abigail Chen以一致且可信的方式回答，陈述了它的年龄、兴趣和对创意项目的热情：“你好，我是Abigail。我25岁，热衷于创意项目。我喜欢从事艺术和动画项目，并且一直在寻找将艺术与技术结合的新方法。”如果没有观察记忆的支持，Abigail会否认认识沙盒世界中的熟人Rajiv Patel。但是在记忆的帮助下，Abigail可以成功回忆起Rajiv并描述它：“Rajiv是一个令人难以置信的人。它对涉及诗歌、艺术作品的项目非常热情。”

生成式代理的记忆并非没有缺陷：它们可能无法从记忆中检索到正确的实例。例如，当被问及地方选举时，Rajiv回答：“我没有太关注选举。”尽管它曾听说过Sam有候选资格。在某些情况下，生成式代理会检索到不完整的记忆片段：当Tom被问及Isabella的情人节派对时，它回答：“呃，我其实不确定是否有情人节派对。但我记得我需要在派对上与Isabella讨论即将到来的市长选举以及我对Sam的看法，如果派对真的发生的话！”在这种情况下，Tom检索到了它和Isabella计划在派对上讨论选举的记忆，但没有检索到它听说过情人节派对的记忆，导致它确定在派对上要做什么，但不确定派对是否真的存在。

有时，生成式代理会对其知识进行幻觉性的润色。生成式代理很少完全编造它们的知识：它们可能无法回忆起某些事件的发生，并通过承认它们缺乏记忆来回应。然而，它们并不会肯定地声称经历了它们没有经历过的事情。尽管如此，它们仍然会出现润色其知识的情况。例如，Isabella知道Sam在地方选举中有候选资格，并在被问及时确认了这一点。然而，它还补充说：“它明天会发表声明。”尽管Sam和Isabella并没有讨论过这样的计划。生成式代理还可能基于生成其响应的大语言模型中编码的世界知识来润色其知识。当Yuriko描述它的邻居Adam Smith时，Yuriko说它是《国富论》的作者，而这本书实际上是由18世纪同名经济学家所写的。 

3. **反思是综合的必要条件**

反思对生成式代理需要对其经验做出更深层次综合的决策时具有优势。例如，当被问及Maria可能会给Wolfgang准备什么生日礼物时，没有反思记忆的Maria将承认它的不确定性，表示它不知道Wolfgang喜欢什么，尽管Maria与Wolfgang有过多次互动。然而，拥有反思记忆的Maria将自信地回答：“既然它对音乐作曲感兴趣，那么我可以给它一些相关的东西。也许是一些关于音乐作曲的书籍，或者一些相关的软件，它可以用来作曲。”



#### 5.8 生成式代理的进一步探讨

1. **交互式沙盒环境的深度**

在斯坦福AI小镇的沙盒环境中，生成式代理的交互不限于简单的问答或指令执行，它们能够表现更为复杂的社会动态。生成式代理们能够根据用户或其他代理的行为和提议，自主地调整自己的计划和行动。例如，如果一个生成式代理提出举办派对，则其他代理将根据自身的记忆和偏好来决定是否参加，以及如何准备和参与活动。

2. **记忆流的复杂性**

记忆流是生成式代理架构中的核心。生成式代理的记忆不仅仅是一系列事件的简单罗列，而是一个经过精心设计的数据库，能够支持根据事件相关性、时效性和重要性进行动态检索。这意味着生成式代理能够根据当前的情境，回忆起与之相关的经历，并利用这些记忆来做出决策。

3. **反思与自我意识**

生成式代理的反思机制赋予了它们类似自我意识的特性。生成式代理能够基于自己的记忆和经验，形成关于自己和其他人的高层次推断。这种能力使得生成式代理在社交互动中能够展现出更为复杂和人性化的行为。

4. **计划与决策的策略**

生成式代理的计划系统是其行为连贯性和目标导向性的关键。生成式代理能够制订长期和短期的计划，并根据环境变化和新信息进行调整。这种计划能力使得生成式代理能够执行复杂的任务，并在面对意外情况时做出合理的反应。 

5. **社会行为的模拟**

斯坦福AI小镇中的生成式代理们能够模拟真实的社会行为，包括建立关系、传播信息、协调活动等。这些社会行为是自发的，意味着它们是通过生成式代理之间的自然互动产生的，而不是预设的脚本。这种自发的社会行为为研究人类社会动态提供了一个独特的实验平台。

6. **用户交互的多样性**

用户与生成式代理的交互可以采取多种形式，从简单的指令和询问到更深入的角色扮演和情感交流。用户可以作为外部观察者，也可以作为生成式代理的“朋友”或“家人”，参与到生成式代理的日常生活中。

7. **伦理和社会影响**

生成式代理的发展引发了诸多伦理和社会问题。例如，用户可能会对生成式代理产生情感依赖，或者生成式代理可能会在没有适当监管的情况下传播不准确的信息。这些问题需要通过跨学科的研究和政策制定来解决。

8. **未来展望**

随着技术的不断发展，生成式代理有望在未来变得更加智能和自主。其可能会被应用于更广泛的领域，如教育、健康护理、娱乐等。同时，研究团队也需要关注这些技术可能带来的挑战，并确保它们的发展与人类的价值观和利益相一致。在AI领域中，生成式代理代表了一种创新的尝试，旨在创建能够模拟可信的人类行为的交互式系统。这些生成式代理不是简单的自动化脚本或预设行为的集合，而是具有记忆、反思和计划能力的复杂系统，能够在动态环境中以可信的方式做出行动和响应。

生成式代理作为一种自发的AI技术，为研究团队提供了一个理解和模拟人类行为的新视角。斯坦福AI小镇的成功构建展示了这些生成式代理在复杂社会环境中的潜力。随着研究的深入和技术的发展，研究团队期待生成式代理在未来能够模拟出更加丰富和真实的人类行为，同时为研究团队提供关于人类社会和行为的深刻见解。 
